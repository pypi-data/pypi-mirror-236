(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{41649:function(e,n,t){Promise.resolve().then(t.bind(t,22582))},22582:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return b}});var l=t(57437),s=t(31706),a=t(62572),r=t(51809),i=t(17933),c=t(55856),o=t(85290),d=t(10887),u=t(67896),m=t(33116),h=t(2265),x=t(98809),p=t(43241),g=t(78583),v=t(21037);function b(e){let{context:n,config:t,initMessages:b,viewHeight:f="100%"}=e,j=h.useRef(null),N=h.useRef(null),k="/api",[w,y]=h.useState(!1),[Z,C]=h.useState({status:!0,message:"All good"}),[E,S]=h.useState([]);console.log("serverUrl",k);let O=e=>e.map(e=>{let n;try{n=JSON.parse(e.metadata)}catch(t){n=e.metadata}let t={text:e.content,sender:"user"===e.role?"user":"bot",metadata:n,msgId:e.msgId};return t});h.useEffect(()=>{let e=O(b);S(e)},[b]);let P=E.map((e,n)=>{var t,c,o,d;let m="user"===e.sender,h=!1;e.metadata&&(h=null!==e.metadata.code||(null===(t=e.metadata.images)||void 0===t?void 0:t.length)>0||(null===(c=e.metadata.files)||void 0===c?void 0:c.length)>0||(null===(o=e.metadata.scripts)||void 0===o?void 0:o.length)>0);let b=[];return m&&b.push({label:(0,l.jsx)("div",{onClick:()=>{console.log("retrying"),T(e.text)},children:(0,l.jsxs)("span",{className:"inline-block",children:[" ",(0,l.jsx)(s.Z,{role:"button",title:"Retry",className:"h-4 w-4 mr-1 inline-block"}),"Retry"]})}),key:"retrymessage"}),h&&b.push({label:(0,l.jsxs)("div",{onClick:()=>{},children:[(0,l.jsx)(a.Z,{title:"View Metadata",className:"h-4 w-4 mr-1 inline-block"}),"View Metadata"]}),key:"metadata"}),u.Z,(0,l.jsxs)("div",{className:"align-right ".concat(m?"text-right":"","  mb-2 "),children:[" ",(0,l.jsxs)("div",{className:"  ".concat(m?"":" w-full"," inline-flex gap-2"),children:[(0,l.jsxs)("div",{className:"",children:[" ",m&&(0,l.jsx)(r.Z,{className:"inline-block h-6 "}),!m&&(0,l.jsxs)("span",{className:"inline-block  text-accent  bg-primary pb-2 ml-1",children:[(0,l.jsx)(i.Z,{className:"inline-block h-6 "})," "]})]}),(0,l.jsxs)("div",{className:"inline-block ".concat(m?"":" w-full "," p-2 rounded  ").concat(m?"bg-accent text-white  ":"bg-light"),children:[" ",m&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"inline-block",children:[e.text,(0,l.jsx)("div",{role:"button",onClick:()=>{console.log("retrying"),T(e.text)},children:(0,l.jsxs)("span",{className:"inline-block",children:[" ",(0,l.jsx)(s.Z,{role:"button",title:"Retry",className:"h-4 w-4 mr-1 inline-block"}),"Retry"]})})]})}),!m&&(0,l.jsxs)("div",{className:"   w-full chatbox prose dark:prose-invert text-primary rounded p-2 ",children:[(0,l.jsx)(p.U,{remarkPlugins:[x.Z],components:{code(e){let{node:n,inline:t,className:s,children:a,...r}=e,i=/language-(\w+)/.exec(s||""),c=i?i[1]:"text";return!t&&i?(0,l.jsx)(v.Z,{...r,style:g.Z,language:c,className:"rounded",PreTag:"div",wrapLongLines:!0,children:String(a).replace(/\n$/,"")}):(0,l.jsx)("code",{...r,className:s,children:a})}},children:null==(d=(d=e.text).replace(/\n/g,"  \n"))?void 0:d.replace(/```markdown\s+([\s\S]*?)\s+```/g,(e,n)=>n)}),(0,l.jsxs)("div",{className:"text-xs mt-1",children:[e.metadata.length," messages"]})]})]})]})]},"message"+n)});h.useEffect(()=>{_()},[E]),h.useEffect(()=>{!1===w&&j.current&&j.current&&(null===Z||Z&&!1===Z.status)&&(j.current.value="")},[w]),h.useEffect(()=>{},[]);let R=e=>{let n="";return e.forEach(e=>{n+=e.text+"\n"}),n},_=()=>{var e;null===(e=N.current)||void 0===e||e.scroll({top:N.current.scrollHeight,behavior:"smooth"})},I=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;for(let t=e.length-1;t>=0;t--){let l=e[t].content;if(l.length>n)return l}return null},T=e=>{C(null);let n=Object.assign([],E);R(E),n.push({text:e,sender:"user"}),S(n);let t={prompt:e};console.log("payload",t);let l="".concat(k,"/generate"),s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)};y(!0),fetch(l,s).then(e=>{y(!1),200===e.status?e.json().then(e=>{if(e&&e.status){console.log("******* response received ",e);let t=I(e.data),l={text:t,sender:"bot",metadata:e.data};n.push(l),S(n=Object.assign([],n))}else console.log("error",e),m.ZP.error(e.message)}):m.ZP.error("Connection error. Ensure server is up and running.")}).catch(e=>{y(!1),m.ZP.error("Connection error. Ensure server is up and running.")})};return(0,l.jsxs)("div",{style:{height:"calc(100% - 20px)"},className:"text-primary   overflow-auto relative   rounded  ",children:[(0,l.jsxs)("div",{style:{height:"calc(100% - 70px)"},ref:N,className:"flex overflow-auto  flex-col rounded  scroll pr-2   ",children:[(0,l.jsx)("div",{className:"flex-1  boder mt-4"}),(0,l.jsxs)("div",{className:"ml-2 ",children:[" ",P]}),(0,l.jsx)("div",{className:"ml-2 h-6   mb-4 mt-2   ",children:w&&(0,l.jsxs)("div",{className:"inline-flex gap-2",children:[(0,l.jsx)("span",{className:"  rounded-full bg-accent h-2 w-2  inline-block"}),(0,l.jsx)("span",{className:"animate-bounce rounded-full bg-accent h-3 w-3  inline-block"}),(0,l.jsx)("span",{className:" rounded-full bg-accent h-2 w-2  inline-block"})]})})]}),(0,l.jsxs)("div",{className:"mt-2 p-2 absolute   bottom-0 w-full",children:[(0,l.jsxs)("div",{className:"mt-2   rounded p-2 shadow-lg flex mb-1    ".concat(w?" opacity-50 pointer-events-none":""),children:[(0,l.jsx)("form",{autoComplete:"on",className:"flex-1 ",onSubmit:e=>{e.preventDefault()},children:(0,l.jsx)("input",{id:"queryInput",name:"queryInput",autoComplete:"on",onKeyDown:e=>{if("Enter"===e.key&&j.current&&!w){var n;T(null===(n=j.current)||void 0===n?void 0:n.value)}},ref:j,className:"w-full text-gray-600 rounded rounded-r-none border border-accent bg-white p-2   ropunded-sm"})}),(0,l.jsxs)("div",{role:"button",onClick:()=>{if(j.current&&!w){var e;T(null===(e=j.current)||void 0===e?void 0:e.value)}},className:"bg-accent   hover:brightness-75 transition duration-300 rounded pt-2 rounded-l-none px-5 ",children:[" ",!w&&(0,l.jsxs)("div",{className:"inline-block     ",children:[(0,l.jsx)(c.Z,{className:"h-6 text-white   inline-block"})," "]}),w&&(0,l.jsx)("div",{className:"inline-block   ",children:(0,l.jsx)(o.Z,{className:"relative -pb-2 text-white animate-spin  inline-flex rounded-full h-6 w-6"})})]})]})," ",Z&&!Z.status&&(0,l.jsxs)("div",{className:"p-2 border rounded mt-4 text-orange-500 text-sm",children:[" ",(0,l.jsx)(d.Z,{className:"h-5 text-orange-500 inline-block mr-2"})," ",Z.message]})]})]})}}},function(e){e.O(0,[900,142,971,864,744],function(){return e(e.s=41649)}),_N_E=e.O()}]);