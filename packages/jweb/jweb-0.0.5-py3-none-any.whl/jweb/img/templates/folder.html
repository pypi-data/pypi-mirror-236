<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Image Viewer</title>
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
      #file-list {
        width: 30%;
        overflow-y: auto;
        max-height: 1000px;
        position: sticky;
        top: 0; /* This will make it stick to the top edge of its container */
      }
      #image-display {
        width: 70%;
        float: left;
      }
      img {
        max-width: 800px;
        max-height: 800px;
      }
      .caption {
        font-size: 16px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12 mt-1">
          <h1>{{ title | safe }}</h1>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 mt-1">{{ html_content | safe }}</div>
      </div>
      <div class="row mb-3 align-items-center">
        <div class="col-md-2">
          <button
            id="clear-checkboxes"
            class="btn btn-secondary btn-block mb-1"
          >
            Clear Selection
          </button>
        </div>
        <div class="col-md-2">
          <button id="select-all" class="btn btn-primary btn-block mb-1">
            Select All
          </button>
        </div>
        <div class="col-md-8">
          <input
            id="regex"
            class="form-control"
            placeholder="Enter regex to filter"
          />
        </div>
      </div>

      <div class="row">
        <div id="file-list" class="list-group col-md-3"></div>
        <div id="image-display" class="col-md-9 mt-1"></div>
      </div>
    </div>

    <script>
      function loadFiles(regex) {
        let endpoint = regex ? `/list_images/${regex}` : "/list_images/";
        $.getJSON(endpoint, function (data) {
          $("#file-list").empty();
          data.files.forEach((file) => {
            let listItem = `
            <div class="list-group-item">
              <div class="form-check">
                <input class="form-check-input image-checkbox" type="checkbox" value="${file}">
                <label class="form-check-label">${file}</label>
              </div>
            </div>`;
            $("#file-list").append(listItem);
          });
        }).fail(function () {
          $("#file-list").empty();
          $("#file-list").append(
            '<div class="list-group-item text-danger">Invalid regex</div>',
          );
        });
      }

      $(document).ready(function () {
        loadFiles("");

        // Clear all checkboxes
        $("#clear-checkboxes").click(function () {
          $(".image-checkbox").prop("checked", false);
          $("#image-display").empty();
        });

        $("#regex").on("input", function () {
          loadFiles($(this).val());
        });

        // Select all checkboxes and display all images
        $("#select-all").click(function () {
          $(".image-checkbox").prop("checked", true);
          $("#image-display").empty();
          $(".image-checkbox:checked").each(function () {
            let filePath = `${$(this).val()}`;
            let imageWithCaption = `
            <div class="text-center">
                <div class="caption">${filePath}</div>
                <img src="${filePath}" alt="${filePath}">
            </div><br>`;
            $("#image-display").append(imageWithCaption);
          });
        });

        $(document).on("change", ".image-checkbox", function () {
          $("#image-display").empty();
          $(".image-checkbox:checked").each(function () {
            let filePath = `${$(this).val()}`;
            let imageWithCaption = `
            <div class="text-center">
                <div class="caption">${filePath}</div>
                <img src="${filePath}" alt="${filePath}">
            </div><br>`;
            $("#image-display").append(imageWithCaption);
          });
        });
      });
    </script>
  </body>
</html>
