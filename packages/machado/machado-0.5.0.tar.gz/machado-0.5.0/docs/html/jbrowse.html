<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.3. JBrowse (optional) &mdash; machado 0.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3.4. Cache (optional)" href="cache.html" />
    <link rel="prev" title="3.2. Web server" href="webserver.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> machado
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataload.html">2. Data loading</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="visualization.html">3. Visualization</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index_search.html">3.1. Index and search</a></li>
<li class="toctree-l2"><a class="reference internal" href="webserver.html">3.2. Web server</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.3. JBrowse</a></li>
<li class="toctree-l2"><a class="reference internal" href="cache.html">3.4. Cache</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="diagrams.html">4. Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">5. Models</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">machado</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="visualization.html"><span class="section-number">3. </span>Visualization</a></li>
      <li class="breadcrumb-item active"><span class="section-number">3.3. </span>JBrowse (optional)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/jbrowse.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="jbrowse-optional">
<h1><span class="section-number">3.3. </span>JBrowse (optional)<a class="headerlink" href="#jbrowse-optional" title="Permalink to this heading"></a></h1>
<p>The <a class="reference external" href="https://jbrowse.org">JBrowse</a> software renders genomic tracks from Chado using the <em>machado</em> API.</p>
<p><strong>JBrowse</strong></p>
<p>Before installing Jbrowse you should probably have Bioperl installed in your system (tested in Ubuntu 20.04):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>bioperl
</pre></div>
</div>
<p>Then install JBrowse following the <a class="reference external" href="https://jbrowse.org/docs/installation.html">official instructions</a>:</p>
<p>In Ubuntu 20.04:</p>
<p>Install some prerequisites:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>build-essential<span class="w"> </span>zlib1g-dev<span class="w"> </span>curl
</pre></div>
</div>
</div></blockquote>
<p>Also <em>Node.js</em> is needed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-sL<span class="w"> </span>https://deb.nodesource.com/setup_12.x<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>-E<span class="w"> </span>bash<span class="w"> </span>-
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nodejs
</pre></div>
</div>
<p>Finally, proceed with JBrowse installation</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://github.com/GMOD/jbrowse/releases/download/1.16.9-release/JBrowse-1.16.9.zip
unzip<span class="w"> </span>JBrowse-1.16.9.zip
sudo<span class="w"> </span>mv<span class="w"> </span>JBrowse-1.16.9<span class="w"> </span>/var/www/html/jbrowse
<span class="nb">cd</span><span class="w"> </span>/var/www/html
sudo<span class="w"> </span>chown<span class="w"> </span><span class="sb">`</span>whoami<span class="sb">`</span><span class="w"> </span>jbrowse
<span class="nb">cd</span><span class="w"> </span>jbrowse
./setup.sh<span class="w"> </span><span class="c1"># don&#39;t do sudo ./setup.sh</span>
</pre></div>
</div>
<p><strong>configuring JBrowse</strong></p>
<p>The <em>machado</em> source contains the directory extras. Copy the file extras/trackList.json.sample to the JBrowse data directory, inside a subdirectory with the name of the organism (e.g. /var/www/html/jbrowse/data/Arabidopsis thaliana) and rename it to trackList.json
This directory structure will enable machado to embed JBrowse in its pages.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;/var/www/html/jbrowse/data/Arabidopsis thaliana&quot;</span>
cp<span class="w"> </span>extras/trackList.json.sample<span class="w"> </span><span class="s2">&quot;/var/www/html/jbrowse/data/Arabidopsis thaliana/trackList.json&quot;</span>
</pre></div>
</div>
<p>Edit the file trackList.json to set the <strong>organism</strong> name you have loaded to the database.</p>
<p><strong>In case you have WSGI apache module configured and running</strong>, change the <em>baseUrl</em> variable in trackList.json to refer to the proper address:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>baseUrl<span class="s2">&quot;:    &quot;</span>http://localhost/YOURPROJECT/api/jbrowse<span class="s2">&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Now repeat the steps above for as many other organisms as you may have loaded to the database.</p></li>
<li><p>Remember to restart the Apache server after the modifications.</p></li>
</ul>
<p><strong>machado API</strong></p>
<p><strong>In case you don’t have the WSGI module installed under Apache</strong> (and did change the <em>baseUrl</em> variable in trackList.json), start the <em>machado</em> API framework:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>manage.py<span class="w"> </span>runserver
</pre></div>
</div>
<p>Once the server is running, just go to your browser and open your JBrowse instance (e.g.: <a class="reference external" href="http://localhost/jbrowse/?data=data/Arabidopsis thaliana">http://localhost/jbrowse/?data=data/Arabidopsis thaliana</a> ).</p>
<p><strong>machado</strong></p>
<p>The settings.py file should contain these variables in order to have the jbrowse visualization embedded to the feature page. Don’t forget to restart apache to make the settings changes up to date.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">MACHADO_JBROWSE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;http://localhost/jbrowse&#39;</span>

<span class="nv">MACHADO_JBROWSE_TRACKS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ref_seq,gene,transcripts,CDS,SNV&#39;</span>

<span class="nv">MACHADO_JBROWSE_OFFSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1200</span>
</pre></div>
</div>
<p>MACHADO_JBROWSE_URL: the base URL to the JBrowse instalation. The URL must contain the protocol (i.e. http or https)</p>
<p>MACHADO_JBROWSE_TRACKS: the name of the tracks to be displayed (‘ref_seq,gene,transcripts,CDS,SNV’ if not set).</p>
<p>MACHADO_OFFSET: the number of bp upstream and downstream of the feature (1000 if not set).</p>
<section id="use-reference-from-fasta-file-optional">
<h2><span class="section-number">3.3.1. </span>Use reference from FASTA file (optional)<a class="headerlink" href="#use-reference-from-fasta-file-optional" title="Permalink to this heading"></a></h2>
<p>If the reference sequences are really long (&gt;200Mbp), there may be memory issues during the loading process and JBrowse may take too long to render the tracks. To avoid this, follow instructions to create and use and indexed fasta file as source the reference sequences <a class="reference external" href="https://jbrowse.org/docs/tutorial.html">https://jbrowse.org/docs/tutorial.html</a>.</p>
<p>Follow the steps below.</p>
<p>Put the genome’s assembly fasta file into your jbrowse organism’s ‘data/seq’ directory (for example: /var/www/html/jbrowse/data/’Glycine max’/data/seq/Gmax.fa), change to this directory, and run the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>samtools<span class="w"> </span>faidx<span class="w"> </span>Gmax.fa
</pre></div>
</div>
<ul class="simple">
<li><p>A ‘Gmax.fa.fai’ indexed fasta file will be created.</p></li>
</ul>
<p>Now, modify your default trackList.json file. You need to make two modifications, first replace the “refSeqs” entry line (probably the second line of the file) with the following line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;refSeqs&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;data/seq/Gmax.fa.fai&quot;</span>,
</pre></div>
</div>
<p>And then change a whole code chunk, as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w"> </span><span class="s2">&quot;category&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;1. Reference sequence&quot;</span>,
<span class="w"> </span><span class="s2">&quot;faiUrlTemplate&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;data/seq/Gmax.fa.fai&quot;</span>,
<span class="w"> </span><span class="s2">&quot;key&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;Reference sequence&quot;</span>,
<span class="w"> </span><span class="s2">&quot;label&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;ref_seq&quot;</span>,
<span class="w"> </span><span class="s2">&quot;seqType&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;dna&quot;</span>,
<span class="w"> </span><span class="s2">&quot;storeClass&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;JBrowse/Store/SeqFeature/IndexedFasta&quot;</span>,
<span class="w"> </span><span class="s2">&quot;type&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;SequenceTrack&quot;</span>,
<span class="w"> </span><span class="s2">&quot;urlTemplate&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;data/seq/Gmax.fa&quot;</span>,
<span class="w"> </span><span class="s2">&quot;useAsRefSeqStore&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">1</span>
<span class="o">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The code above should replace all code from the “1. Referece sequence” category track code chunk.</p></li>
<li><p>make sure “urlTemplate” points to the fasta file path, not the .fai indexed one.</p></li>
</ul>
<p>Now restart the apache daemon for changes to take effect.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>restart<span class="w"> </span>apache2
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="webserver.html" class="btn btn-neutral float-left" title="3.2. Web server" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cache.html" class="btn btn-neutral float-right" title="3.4. Cache (optional)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Embrapa.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>