"use strict";(self.webpackChunkpersist_ext=self.webpackChunkpersist_ext||[]).push([[245],{9245:(e,t,n)=>{n.r(t),n.d(t,{default:()=>q});var r=n(9135),a=n(3027),s=n(3408),i=n(9684),o=n(2405),l=n(154),c=n(6590),d=n(6118);function u(e){return(0,d.decompressFromUTF16)(e)}function h(e){return{getItem(t){const n=e.model.getMetadata(t);return n?u(n):n},setItem(t,n){e.model.setMetadata(t,n?(0,d.compressToUTF16)(n):n)},removeItem:t=>e.model.deleteMetadata(t)}}var p=n(6128),m=n(4901),g=n(5103);function _(){return(0,g.v4)()}const C={id:_(),type:"create"};class b{static getInstance(e){return new b(e)}constructor(e){this._cell=e,this._notifyTrrackInstanceChange=new m.Signal(this),this._registry=p.Registry.create(),this._notifyCurrentChange=new m.Signal(this),this._unsubscribeCurrentChangeListener=null,b._instanceMaps.set(e,this),this._addInteractionAction=this._registerAddInteractionAction(),this.loadTrrack(this._cell.trrackGraph)}get trrackInstanceChange(){return this._notifyTrrackInstanceChange}get currentChange(){return this._notifyCurrentChange}get trrack(){return this._trrack}reset(){this.loadTrrack(),this._cell.generatedDataframesState.set({})}loadTrrack(e=null){const t=()=>{this._cell.trrackGraphState.set(this._graph),window.Persist.Commands.registry.notifyCommandChanged(),this._notifyCurrentChange.emit(this._trrack.current.id)};this._unsubscribeCurrentChangeListener&&this._unsubscribeCurrentChangeListener(),this._trrack=(0,p.initializeTrrack)({registry:this._registry,initialState:C}),e&&e.root!==this._trrack.root.id&&this._trrack.importObject(e),this._unsubscribeCurrentChangeListener=this._trrack.currentChange(t),t(),this._notifyTrrackInstanceChange.emit(this._trrack)}apply(e,t){return this._trrack.apply(function(e){return"function"==typeof e?e():e}(t),this._addInteractionAction(e))}get _graph(){return this._trrack.exportObject()}_registerAddInteractionAction(){return this._registry.register("interaction",((e,t)=>t))}}b._instanceMaps=new WeakMap;var y=n(4439);function k(e){return(0,y.cloneDeep)(e)}const f="trrack_graph",v="__GENERATED_DATAFRAMES__";class w extends r.CodeCell{constructor(e){if(super(e),this.activeCategory=(0,o.hookstate)(null,(0,l.localstored)({key:"active-category",engine:h(this)})),!window.Persist.CellMap)throw new Error("Entry point not executed");window.Persist.CellMap.set(this.cell_id,this);const t=this.model.getMetadata(v);t&&JSON.parse(u(t)),this._generatedDataframes=(0,o.hookstate)({},(0,o.extend)((0,c.subscribable)(),(0,l.localstored)({key:v,engine:h(this)})));const n=this.model.getMetadata(f),r=n?JSON.parse(u(n)):null;this._trrackGraph=(0,o.hookstate)(r,(0,l.localstored)({key:f,engine:h(this)})),this.trrackManager=b.getInstance(this),this.node.dataset.id=this.cell_id,this.node.dataset.celltype="code-cell"}get generatedDataframesState(){return this._generatedDataframes}get generatedDataframes(){return k(this._generatedDataframes.get({noproxy:!0}))}get trrackGraphState(){return this._trrackGraph}get trrackGraph(){return k(this._trrackGraph.get({noproxy:!0}))}get cell_id(){return this.model.id}dispose(){this.isDisposed||(window.Persist.CellMap.delete(this.cell_id),super.dispose())}}!function(e){e.create=function(t){return new e(t)},e.isTrrackableCell=function(t){return t instanceof e}}(w||(w={}));class S extends s.NotebookPanel.ContentFactory{createCodeCell(e){return w.create(e).initializeState()}}var x=n(7930);const M="__persist_nb_uuid__";new Map;class D{constructor(e=null){var t;this._nbPanel=e,this._setupFinishDelegate=new x.PromiseDelegate,this._nb=null==e?void 0:e.content,null===(t=this._nbPanel)||void 0===t||t.context.ready.then((()=>async function(e){return await async function(e){return e.model&&(e.nbUid||(e.model.setMetadata(M,_()),await e.save())),Promise.resolve()}(e),Promise.resolve()}(this))).then((()=>{this._setupFinishDelegate.resolve()}))}get nb(){return this._nb}get nbPanel(){return this._nbPanel}get model(){var e;return null===(e=this._nbPanel)||void 0===e?void 0:e.model}get setupFinish(){return this._setupFinishDelegate.promise}get nbUid(){var e;return null===(e=this.model)||void 0===e?void 0:e.getMetadata(M)}save(){var e;return null===(e=this._nbPanel)||void 0===e?void 0:e.context.save()}}var P=n(6061);const I={execute(e){const{cell:t,name:n,value:r,store:a,brush_type:s}=e,{action:i,label:o}=(u={value:r,name:n,store:(l=a,l?(d=l,c=JSON.stringify(d),JSON.parse(c)):l),brush_type:s},{action:{id:_(),type:"select",...u},label:()=>{console.log({selected:u});const{brush_type:e,name:t,value:n,store:r}=u;if(0===r.length)return"Clear all selections";if("interval"===e){const e=n,t=[];return Object.entries(e).forEach((([e,n])=>{const r=`${e} (${n[0]instanceof Date?n[0].toUTCString():(0,P.isNumeric)(n[0])?Math.round(n[0]):n[0]} to ${n[n.length-1]instanceof Date?n[n.length-1].toUTCString():(0,P.isNumeric)(n[n.length-1])?Math.round(n[n.length-1]):n[n.length-1]})`;t.push(r)})),"Selected "+t.join(", ")}{const e=n;if(e.vlPoint&&e.vlPoint.or){const t=e.vlPoint.or;if(t.length>0)return`Selected ${t.length} ${1===t.length?"point":"points"} across ${Object.keys(t[0]).join(", ")}`}else if("index_selection"===t){const e=n;return 1===e.length?`Selected ${e.length} point`:`Selected ${e.length} points`}}return"Selected Points!"}});var l,c,d,u;return t.trrackManager.apply(i,o)}};function T(e){const{cell:t}=e;return"select"===t.trrackManager.trrack.getState().type}const N={isEnabled:e=>T(e),execute(e){const{cell:t,direction:n}=e,{action:r,label:a}=function(e){return{action:{id:_(),type:"filter",direction:e},label:()=>"out"===e?"Filter selected items":"Keep selected items"}}(n);return t.trrackManager.apply(r,a)},label:e=>{const{direction:t}=e;return"out"===t?"Filter out":"Filter in"}},F={isEnabled:e=>T(e),execute(e){const{cell:t,text:n}=e,{action:r,label:a}=function(e){return{action:{id:_(),type:"annotate",text:e,createdOn:Date.now()},label:()=>"Add annotation to selection: "+e}}(n);return t.trrackManager.apply(r,a)}};var E=n(7120);const $={execute(e){const{cell:t,previousColumnName:n,newColumnName:r}=e,{action:a,label:s}=function(e,t){return{action:{id:_(),type:"rename_column",previousColumnName:e,newColumnName:t},label:()=>`Rename column ${e} to ${t}`}}(n,r);return t.trrackManager.apply(a,s)},label:"Rename Column"},A={execute(e){const{cell:t,columns:n}=e,{action:r,label:a}=function(e){return{action:{id:_(),type:"drop_columns",columns:e},label:()=>e.length>1?`Drop ${e.length} columns`:`Drop column ${e[0]}`}}(n);return t.trrackManager.apply(r,a)},label:"Drop Columns"},O={execute(e){const{cell:t,category:n,option:r}=e,{action:a,label:s}=function(e,t){return{action:{id:_(),type:"categorize",category:e,option:t},label:()=>`Assign category ${e}`}}(n,r);return t.trrackManager.apply(a,s)},label:"Assign Category"},R={execute(e){const{cell:t,sortStatus:n}=e,{action:r,label:a}=function(e){return{action:{id:_(),type:"sortby_column",sortStatus:e},label:()=>1===e.length?`Sort by ${e[0].column}`:`Sort by ${e.length} columns`}}(n);return t.trrackManager.apply(r,a)},label:"Sort Column"},j={execute(e){const{cell:t,columns:n}=e,{action:r,label:a}=function(e){return{action:{id:_(),type:"reorder_column",columns:e},label:()=>"Reorder columns"}}(n);return t.trrackManager.apply(r,a)},label:"Reorder Columns"};var G;!function(e){e.resetTrrack="persist:trrack:reset",e.pointSelection="persist:selection:point",e.intervalSelection="persist:selection:interval",e.intentSelection="persist:selection:intent",e.invertSelection="persist:selection:invert",e.clearSelection="persist:selection:clear",e.categorize="persist:categorize",e.filterOut="persist:filter:out",e.filterIn="persist:filter:in",e.sortByColumn="persist:column:sort",e.reorderColumns="persist:column:order",e.renameColumns="persist:column:rename",e.dropColumns="persist:column:drop",e.annotate="persist:annotate"}(G||(G={}));class J{constructor(){this._commandsDisposeMap=new Map,this._commands=new E.CommandRegistry,this.addCommand(G.resetTrrack,{isEnabled(e){const{cell:t}=e,{nodes:n}=t.trrackManager.trrack.exportObject();return Object.keys(n).length>1},execute(e){const{cell:t}=e;t.trrackManager.reset()},label:"Reset Trrack"}),this.addCommand(G.pointSelection,I),this.addCommand(G.intervalSelection,I),this.addCommand(G.intentSelection,{execute(){throw new Error("not impl")}}),this.addCommand(G.invertSelection,{execute(){throw new Error("not impl")}}),this.addCommand(G.clearSelection,{execute(){throw new Error("not impl")}}),this.addCommand(G.categorize,O),this.addCommand(G.filterOut,N),this.addCommand(G.filterIn,N),this.addCommand(G.sortByColumn,R),this.addCommand(G.reorderColumns,j),this.addCommand(G.renameColumns,$),this.addCommand(G.dropColumns,A),this.addCommand(G.annotate,F)}addCommand(e,t){const n=this._commands.addCommand(e,t);this._commandsDisposeMap.set(e,n)}removeCommand(e){if(!this._commands.hasCommand(e))return!1;const t=this._commandsDisposeMap.get(e);return!!t&&(t.dispose(),this._commandsDisposeMap.delete(e),!0)}execute(e,t){return this._commands.execute(e,t)}get registry(){return this._commands}}var L=n(2861);const z={id:"persist_ext:plugin",description:"PersIst is a JupyterLab extension to enable persistent interactive visualizations in JupyterLab notebooks.",autoStart:!0,requires:[s.INotebookTracker],optional:[i.ISettingRegistry],activate:(e,t,n)=>{console.log("Setting up persist"),window.Persist={CellMap:new Map,Commands:new J,Notebook:new D,Notification:{notify:(...e)=>L.Notification.emit(...e)}},t.currentChanged.connect(((e,t)=>{const n=new D(t);window.Persist.Notebook=n,n.setupFinish.then((()=>{console.log(n.nbUid,"is ready!")}))})),console.log("JupyterLab extension persist_ext is activated!"),n&&n.load(z.id).then((e=>{console.log("persist_ext settings loaded:",e.composite)})).catch((e=>{console.error("Failed to load settings for persist_ext.",e)}))}},U={id:"persist_ext:trrackable-cell-plugin",description:"Trrackable cell plugin companion",autoStart:!0,provides:s.NotebookPanel.IContentFactory,requires:[a.IEditorServices],activate:(e,t)=>{console.log("JupyterLab extension trrackable-persist-cell is activated!");const n=new r.Cell.ContentFactory({editorFactory:t.factoryService.newInlineEditor});return new S(n)}},q=[z,U]}}]);